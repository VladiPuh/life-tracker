# LifeTracker_CANON_v3.1_FINAL_RU

> Актуализация канона после полной стабилизации backend, исправления статусов, внедрения History и синхронизации UX/UI

---

## 0. Статус канона

**Канон зафиксирован.**

- Backend стабилен и проверен фактически.
- Основные продуктовые экраны формализованы.
- Архитектура подтверждена практикой, а не теорией.

Любые изменения ниже этого уровня — только осознанными этапами.

---

## 1. Назначение LifeTracker

LifeTracker — это система поддержки личного развития через:
- минимальные действия;
- фиксацию факта;
- уважение к человеческой нестабильности.

LifeTracker **не оптимизирует человека**.
LifeTracker **поддерживает движение**, даже минимальное.

---

## 2. Архитектура (подтверждено)

### 2.1 Общая схема

```
Frontend (Telegram Mini App)
        ↓
FastAPI Backend
        ↓
SQLite / DB
```

### 2.2 Backend слои (SSOT)

```
routers → services → repositories → models → db
```

- routers — контракт API;
- services — бизнес-смысл;
- repositories — доступ к данным;
- models — структура фактов;
- db — источник истины.

Backend = **Single Source of Truth**.

---

## 3. Статусы и факты (исправлено и зафиксировано)

### 3.1 Канонические статусы

- `MIN` — минимальное достаточное действие;
- `BONUS` — расширенное действие;
- `SKIP` — осознанная пауза;
- `FAIL` — факт невыполнения.

### 3.2 Реализация в данных

Факты хранятся через флаги:
- `flag_min`
- `flag_bonus`
- `flag_skip`
- `flag_fail`

Запрещено:
- дублировать статус в строковом виде в БД;
- вычислять статус на фронте.

`compute_status_view` — **единственное место интерпретации**.

---

## 4. Экран Today (канон подтверждён)

- Единственный экран действия.
- Работает как очередь.
- Один активный челлендж.
- End-state без CTA.

SSOT:
```
GET /today
```

Today **не содержит**:
- истории;
- списков;
- аналитики.

---

## 5. Экран History (НОВОЕ, зафиксировано)

History — экран **фактов без интерпретации**.

SSOT:
```
GET /history/days
```

Принципы:
- только дни с событиями;
- агрегированные факты;
- отсутствие оценки;
- отсутствие управления.

History **не влияет** на Today.

---

## 6. UX/UI канон (синхронизировано)

UX/UI следует смыслам, а не наоборот.

Иерархия:
1. Today — действие
2. History — факт
3. Insights — осмысление
4. New / Templates — конфигурация
5. Profile — идентичность

Анти-паттерны:
- streaks;
- геймификация;
- рейтинги;
- KPI.

---

## 7. Авторизация и режимы

### 7.1 PROD

- Telegram WebApp
- `initData`
- валидация подписи

### 7.2 DEV (подтверждено)

- фиксированный dev-пользователь;
- отсутствие зависимости от Telegram;
- backend работает автономно.

DEV-режим — обязательная часть канона.

---

## 8. Границы ответственности

Frontend:
- отображает факты;
- не интерпретирует данные;
- не хранит состояние дня.

Backend:
- хранит и агрегирует факты;
- вычисляет статус;
- определяет активный челлендж.

---

## 9. Stability rules (жёстко)

Запрещено:
- менять структуру статусов без канона;
- добавлять аналитику в Today или History;
- «лечить» пользователя через UI.

Любое расширение → новый экран + новый канон.

---

## 10. Версионирование

- v3.1 — актуализация после:
  - стабилизации backend;
  - исправления флагов статусов;
  - внедрения History;
  - синхронизации UX/UI канонов.

---

**LifeTracker_CANON_v3.1_FINAL_RU зафиксирован.**

